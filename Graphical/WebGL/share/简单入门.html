<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简单入门 | FrontEnd Docs</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="前端绿书">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.c1486ec1.css" as="style"><link rel="preload" href="/assets/js/app.67496c89.js" as="script"><link rel="preload" href="/assets/js/3.cf7a9944.js" as="script"><link rel="preload" href="/assets/js/148.8184946a.js" as="script"><link rel="preload" href="/assets/js/12.94a768b4.js" as="script"><link rel="prefetch" href="/assets/js/10.72dd51a9.js"><link rel="prefetch" href="/assets/js/100.98c6437a.js"><link rel="prefetch" href="/assets/js/101.eb45a818.js"><link rel="prefetch" href="/assets/js/102.c8059a23.js"><link rel="prefetch" href="/assets/js/103.719a7352.js"><link rel="prefetch" href="/assets/js/104.bb5c0626.js"><link rel="prefetch" href="/assets/js/105.d56b10e7.js"><link rel="prefetch" href="/assets/js/106.ee13bfe6.js"><link rel="prefetch" href="/assets/js/107.beb2f5d5.js"><link rel="prefetch" href="/assets/js/108.ec980ce3.js"><link rel="prefetch" href="/assets/js/109.7fb0fb3c.js"><link rel="prefetch" href="/assets/js/11.a9a74280.js"><link rel="prefetch" href="/assets/js/110.7fa66a00.js"><link rel="prefetch" href="/assets/js/111.9d3ab7f2.js"><link rel="prefetch" href="/assets/js/112.5c7b26a4.js"><link rel="prefetch" href="/assets/js/113.b222d8dd.js"><link rel="prefetch" href="/assets/js/114.94a7e36e.js"><link rel="prefetch" href="/assets/js/115.90a5ee34.js"><link rel="prefetch" href="/assets/js/116.45f014b1.js"><link rel="prefetch" href="/assets/js/117.aaeadc9a.js"><link rel="prefetch" href="/assets/js/118.123a5bb8.js"><link rel="prefetch" href="/assets/js/119.bf94e0aa.js"><link rel="prefetch" href="/assets/js/120.918a8a4c.js"><link rel="prefetch" href="/assets/js/121.6791fa17.js"><link rel="prefetch" href="/assets/js/122.5fae21f2.js"><link rel="prefetch" href="/assets/js/123.0ff6ef7f.js"><link rel="prefetch" href="/assets/js/124.4f076072.js"><link rel="prefetch" href="/assets/js/125.3b628c2c.js"><link rel="prefetch" href="/assets/js/126.47f80e59.js"><link rel="prefetch" href="/assets/js/127.d6e2375f.js"><link rel="prefetch" href="/assets/js/128.b1c16eb7.js"><link rel="prefetch" href="/assets/js/129.ddcee480.js"><link rel="prefetch" href="/assets/js/13.3f4b963d.js"><link rel="prefetch" href="/assets/js/130.259325dd.js"><link rel="prefetch" href="/assets/js/131.420db52f.js"><link rel="prefetch" href="/assets/js/132.08de9589.js"><link rel="prefetch" href="/assets/js/133.369f5900.js"><link rel="prefetch" href="/assets/js/134.60597180.js"><link rel="prefetch" href="/assets/js/135.5d6e8d4f.js"><link rel="prefetch" href="/assets/js/136.fc4795d9.js"><link rel="prefetch" href="/assets/js/137.fe293f5c.js"><link rel="prefetch" href="/assets/js/138.bdf26548.js"><link rel="prefetch" href="/assets/js/139.de2ce565.js"><link rel="prefetch" href="/assets/js/14.c419df94.js"><link rel="prefetch" href="/assets/js/140.ac48cdb4.js"><link rel="prefetch" href="/assets/js/141.b53c7064.js"><link rel="prefetch" href="/assets/js/142.190e982d.js"><link rel="prefetch" href="/assets/js/143.9330f378.js"><link rel="prefetch" href="/assets/js/144.75d77e3b.js"><link rel="prefetch" href="/assets/js/145.859b1115.js"><link rel="prefetch" href="/assets/js/146.fd421688.js"><link rel="prefetch" href="/assets/js/147.71cb52f1.js"><link rel="prefetch" href="/assets/js/149.08f45cb6.js"><link rel="prefetch" href="/assets/js/15.6bde15d0.js"><link rel="prefetch" href="/assets/js/150.2dbd76ae.js"><link rel="prefetch" href="/assets/js/151.63d79f79.js"><link rel="prefetch" href="/assets/js/152.165e84ed.js"><link rel="prefetch" href="/assets/js/153.3a77aa03.js"><link rel="prefetch" href="/assets/js/154.03cccc6b.js"><link rel="prefetch" href="/assets/js/155.954bec1c.js"><link rel="prefetch" href="/assets/js/156.2d0b239b.js"><link rel="prefetch" href="/assets/js/157.b84b94c3.js"><link rel="prefetch" href="/assets/js/158.965c0bf4.js"><link rel="prefetch" href="/assets/js/159.0df6270d.js"><link rel="prefetch" href="/assets/js/16.f64b5708.js"><link rel="prefetch" href="/assets/js/160.1f01d1f1.js"><link rel="prefetch" href="/assets/js/161.bb5365ac.js"><link rel="prefetch" href="/assets/js/162.c11c02c5.js"><link rel="prefetch" href="/assets/js/163.0e36a992.js"><link rel="prefetch" href="/assets/js/164.d0be1d0a.js"><link rel="prefetch" href="/assets/js/165.a996c12e.js"><link rel="prefetch" href="/assets/js/166.04d8b4cd.js"><link rel="prefetch" href="/assets/js/167.5a52dd8c.js"><link rel="prefetch" href="/assets/js/168.6243335c.js"><link rel="prefetch" href="/assets/js/169.f7db8c31.js"><link rel="prefetch" href="/assets/js/17.ec50c2e8.js"><link rel="prefetch" href="/assets/js/18.7e5c0d96.js"><link rel="prefetch" href="/assets/js/19.22328a07.js"><link rel="prefetch" href="/assets/js/20.d1f009d8.js"><link rel="prefetch" href="/assets/js/21.31b999e5.js"><link rel="prefetch" href="/assets/js/22.94a80e87.js"><link rel="prefetch" href="/assets/js/23.c6a77eaa.js"><link rel="prefetch" href="/assets/js/24.6b022e3d.js"><link rel="prefetch" href="/assets/js/25.3ea7d7a5.js"><link rel="prefetch" href="/assets/js/26.4fc702b1.js"><link rel="prefetch" href="/assets/js/27.ae18b4c5.js"><link rel="prefetch" href="/assets/js/28.509e8e1c.js"><link rel="prefetch" href="/assets/js/29.2f2dbcec.js"><link rel="prefetch" href="/assets/js/30.285d2cdc.js"><link rel="prefetch" href="/assets/js/31.78ed841d.js"><link rel="prefetch" href="/assets/js/32.668dd221.js"><link rel="prefetch" href="/assets/js/33.e994e75a.js"><link rel="prefetch" href="/assets/js/34.f45db2b5.js"><link rel="prefetch" href="/assets/js/35.90131936.js"><link rel="prefetch" href="/assets/js/36.e484cdd8.js"><link rel="prefetch" href="/assets/js/37.0dc73f95.js"><link rel="prefetch" href="/assets/js/38.94c002c9.js"><link rel="prefetch" href="/assets/js/39.25b893af.js"><link rel="prefetch" href="/assets/js/4.2f1119d0.js"><link rel="prefetch" href="/assets/js/40.b52df712.js"><link rel="prefetch" href="/assets/js/41.86f1e893.js"><link rel="prefetch" href="/assets/js/42.aabc3fb9.js"><link rel="prefetch" href="/assets/js/43.929d84fe.js"><link rel="prefetch" href="/assets/js/44.35fdd5c1.js"><link rel="prefetch" href="/assets/js/45.ede220bf.js"><link rel="prefetch" href="/assets/js/46.09e63517.js"><link rel="prefetch" href="/assets/js/47.8eec2110.js"><link rel="prefetch" href="/assets/js/48.19ddf9c0.js"><link rel="prefetch" href="/assets/js/49.c00546d1.js"><link rel="prefetch" href="/assets/js/5.48085d33.js"><link rel="prefetch" href="/assets/js/50.9b8689db.js"><link rel="prefetch" href="/assets/js/51.5dd466df.js"><link rel="prefetch" href="/assets/js/52.9cb4bcd5.js"><link rel="prefetch" href="/assets/js/53.9bd1ce7a.js"><link rel="prefetch" href="/assets/js/54.003b9d7f.js"><link rel="prefetch" href="/assets/js/55.2d7fc27b.js"><link rel="prefetch" href="/assets/js/56.56f6b85a.js"><link rel="prefetch" href="/assets/js/57.74d54da1.js"><link rel="prefetch" href="/assets/js/58.8815e01d.js"><link rel="prefetch" href="/assets/js/59.c7420375.js"><link rel="prefetch" href="/assets/js/6.d8f8d980.js"><link rel="prefetch" href="/assets/js/60.ccd9357e.js"><link rel="prefetch" href="/assets/js/61.6a22933e.js"><link rel="prefetch" href="/assets/js/62.1d72f48f.js"><link rel="prefetch" href="/assets/js/63.59f63f00.js"><link rel="prefetch" href="/assets/js/64.cb59af98.js"><link rel="prefetch" href="/assets/js/65.64418aac.js"><link rel="prefetch" href="/assets/js/66.2cb00529.js"><link rel="prefetch" href="/assets/js/67.08980ba0.js"><link rel="prefetch" href="/assets/js/68.cdd0269c.js"><link rel="prefetch" href="/assets/js/69.a861ad80.js"><link rel="prefetch" href="/assets/js/7.f8e9d384.js"><link rel="prefetch" href="/assets/js/70.09840999.js"><link rel="prefetch" href="/assets/js/71.44a5a193.js"><link rel="prefetch" href="/assets/js/72.2d132b64.js"><link rel="prefetch" href="/assets/js/73.7ef286d2.js"><link rel="prefetch" href="/assets/js/74.07bf8129.js"><link rel="prefetch" href="/assets/js/75.90fe3ca7.js"><link rel="prefetch" href="/assets/js/76.56c2c99a.js"><link rel="prefetch" href="/assets/js/77.af57fbbf.js"><link rel="prefetch" href="/assets/js/78.7c8a06ff.js"><link rel="prefetch" href="/assets/js/79.fe7ea232.js"><link rel="prefetch" href="/assets/js/8.0852472a.js"><link rel="prefetch" href="/assets/js/80.34c69a2e.js"><link rel="prefetch" href="/assets/js/81.0a6b3334.js"><link rel="prefetch" href="/assets/js/82.d2ea377d.js"><link rel="prefetch" href="/assets/js/83.a2385caa.js"><link rel="prefetch" href="/assets/js/84.31ceb4a2.js"><link rel="prefetch" href="/assets/js/85.9a3c6911.js"><link rel="prefetch" href="/assets/js/86.a2dd891d.js"><link rel="prefetch" href="/assets/js/87.f66f4793.js"><link rel="prefetch" href="/assets/js/88.597c0c7b.js"><link rel="prefetch" href="/assets/js/89.49025ed1.js"><link rel="prefetch" href="/assets/js/9.fd9e5888.js"><link rel="prefetch" href="/assets/js/90.c41cf32e.js"><link rel="prefetch" href="/assets/js/91.0ed38cd2.js"><link rel="prefetch" href="/assets/js/92.b45d23a4.js"><link rel="prefetch" href="/assets/js/93.5395792e.js"><link rel="prefetch" href="/assets/js/94.70f92ca6.js"><link rel="prefetch" href="/assets/js/95.046c7977.js"><link rel="prefetch" href="/assets/js/96.10714986.js"><link rel="prefetch" href="/assets/js/97.d59afd13.js"><link rel="prefetch" href="/assets/js/98.037e0ea9.js"><link rel="prefetch" href="/assets/js/99.cbd43b24.js"><link rel="prefetch" href="/assets/js/vendors~notification.2df74b03.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c1486ec1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">FrontEnd Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Develop/" class="nav-link">
  工程开发
</a></div><div class="nav-item"><a href="/Client/" class="nav-link">
  端技术
</a></div><div class="nav-item"><a href="/Engineering/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/Graphical/" class="nav-link router-link-active">
  图形技术
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多专题" class="dropdown-title"><span class="title">更多专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          中台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SSR/start.html" class="nav-link">
  SSR
</a></li><li class="dropdown-subitem"><a href="/Node/start.html" class="nav-link">
  Node
</a></li><li class="dropdown-subitem"><a href="/Middleware/start.html" class="nav-link">
  中间件
</a></li><li class="dropdown-subitem"><a href="/MicroFrontend/start.html" class="nav-link">
  微前端
</a></li><li class="dropdown-subitem"><a href="/Serverless/start.html" class="nav-link">
  Serverless
</a></li></ul></li><li class="dropdown-item"><h4>
          媒体技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Audio/start.html" class="nav-link">
  音频
</a></li><li class="dropdown-subitem"><a href="/Video/start.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          跨端技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Flutter/start.html" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/PWA/start.html" class="nav-link">
  PWA
</a></li><li class="dropdown-subitem"><a href="/React-Native/start.html" class="nav-link">
  React-Native
</a></li></ul></li><li class="dropdown-item"><h4>
          编程思想
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrameworkDesign/start.html" class="nav-link">
  框架设计
</a></li><li class="dropdown-subitem"><a href="/DesignPattern/start.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          底层原理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/V8/start.html" class="nav-link">
  V8
</a></li><li class="dropdown-subitem"><a href="/Webkit/start.html" class="nav-link">
  webkit
</a></li><li class="dropdown-subitem"><a href="/VirtualDOM/start.html" class="nav-link">
  virtual DOM
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Develop/" class="nav-link">
  工程开发
</a></div><div class="nav-item"><a href="/Client/" class="nav-link">
  端技术
</a></div><div class="nav-item"><a href="/Engineering/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/Graphical/" class="nav-link router-link-active">
  图形技术
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多专题" class="dropdown-title"><span class="title">更多专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          中台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/SSR/start.html" class="nav-link">
  SSR
</a></li><li class="dropdown-subitem"><a href="/Node/start.html" class="nav-link">
  Node
</a></li><li class="dropdown-subitem"><a href="/Middleware/start.html" class="nav-link">
  中间件
</a></li><li class="dropdown-subitem"><a href="/MicroFrontend/start.html" class="nav-link">
  微前端
</a></li><li class="dropdown-subitem"><a href="/Serverless/start.html" class="nav-link">
  Serverless
</a></li></ul></li><li class="dropdown-item"><h4>
          媒体技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Audio/start.html" class="nav-link">
  音频
</a></li><li class="dropdown-subitem"><a href="/Video/start.html" class="nav-link">
  视频
</a></li></ul></li><li class="dropdown-item"><h4>
          跨端技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Flutter/start.html" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/PWA/start.html" class="nav-link">
  PWA
</a></li><li class="dropdown-subitem"><a href="/React-Native/start.html" class="nav-link">
  React-Native
</a></li></ul></li><li class="dropdown-item"><h4>
          编程思想
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrameworkDesign/start.html" class="nav-link">
  框架设计
</a></li><li class="dropdown-subitem"><a href="/DesignPattern/start.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          底层原理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/V8/start.html" class="nav-link">
  V8
</a></li><li class="dropdown-subitem"><a href="/Webkit/start.html" class="nav-link">
  webkit
</a></li><li class="dropdown-subitem"><a href="/VirtualDOM/start.html" class="nav-link">
  virtual DOM
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SVG</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>WebGL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Graphical/WebGL/standard.html" class="sidebar-link">规范</a></li><li><a href="/Graphical/WebGL/best-practices.html" class="sidebar-link">最佳实践</a></li><li><a href="/Graphical/WebGL/share/flexbox指南.html" class="sidebar-link">flexbox 指南</a></li><li><a href="/Graphical/WebGL/share/GLSL语言.html" class="sidebar-link">GLSL语言</a></li><li><a href="/Graphical/WebGL/share/GPGPU（通用计算）.html" class="sidebar-link">GPGPU（通用计算）</a></li><li><a href="/Graphical/WebGL/share/WebGL学习资源.html" class="sidebar-link">WebGL学习资源</a></li><li><a href="/Graphical/WebGL/share/图像处理技术-空间像素篇.html" class="sidebar-link">图像处理技术-空间像素篇</a></li><li><a href="/Graphical/WebGL/share/简单入门.html" class="active sidebar-link">简单入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#获取-webgl-上下文" class="sidebar-link">获取 webgl 上下文</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#绘制第一个图形" class="sidebar-link">绘制第一个图形</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#js-与着色器程序交互" class="sidebar-link">js 与着色器程序交互</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#使用纹理" class="sidebar-link">使用纹理</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#像素运算" class="sidebar-link">像素运算</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#矩阵" class="sidebar-link">矩阵</a></li><li class="sidebar-sub-header"><a href="/Graphical/WebGL/share/简单入门.html#_3d-成像" class="sidebar-link">3D 成像</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>可视化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="简单入门"><a href="#简单入门" class="header-anchor">#</a> 简单入门</h1> <blockquote><p>阅读此章节，请确保已经阅读过<a href="/Graphical/WebGL/share/GLSL语言.html">GLSL 语言</a>，对 GLSL 里面的一些概念、类型、运算符等有大致了解。如果你在阅读的过程中遇到不懂的js API，请使用MDN查询他们的详细内容</p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#获取-webgl-上下文">获取 webgl 上下文</a><ul><li><a href="#浏览器端">浏览器端</a></li><li><a href="#微信小程序端">微信小程序端</a></li><li><a href="#微信小游戏端">微信小游戏端</a></li></ul></li><li><a href="#绘制第一个图形">绘制第一个图形</a><ul><li><a href="#webgl绘制流程">webgl绘制流程</a></li><li><a href="#着色器代码">着色器代码</a></li><li><a href="#js代码">js代码</a></li><li><a href="#完整代码">完整代码</a></li></ul></li><li><a href="#js-与着色器程序交互">js 与着色器程序交互</a><ul><li><a href="#修改源码">修改源码</a></li><li><a href="#修改缓存">修改缓存</a></li><li><a href="#使用attribute变量修改">使用attribute变量修改</a></li><li><a href="#使用varying传递变量">使用varying传递变量</a></li><li><a href="#使用uniform传递变量">使用uniform传递变量</a></li></ul></li><li><a href="#使用纹理">使用纹理</a></li><li><a href="#像素运算">像素运算</a></li><li><a href="#矩阵">矩阵</a></li><li><a href="#_3d-成像">3D 成像</a></li></ul></div><p></p> <h2 id="获取-webgl-上下文"><a href="#获取-webgl-上下文" class="header-anchor">#</a> 获取 webgl 上下文</h2> <p>webgl 上下文（WebglRenderingContext），是浏览器提供给 javascript 使用 webgl 绘图的接口，所有与 webgl 相关的操作都与 webgl 上下文相关。这个对象，只能通过调用<code>HTMLCanvasElement</code>的<code>getContext</code>方法获得:</p> <h3 id="浏览器端"><a href="#浏览器端" class="header-anchor">#</a> 浏览器端</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建一个canvas元素</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取webgl上下文</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在调用<code>getContext</code>方法的时候传入<code>webgl</code>或<code>experimental-webgl</code>字符串，可以创建 webgl 上下文。</p> <h3 id="微信小程序端"><a href="#微信小程序端" class="header-anchor">#</a> 微信小程序端</h3> <p>在微信小程序中，同样也可以使用 webgl，而且小程序中的 webgl 上下文中实现的属性、方法与浏览器端完全一致,（但会有部分微信版本存在 bug，比如无法实现透明通道），获取上下文的方式也是一样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- canvas.wxml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCanvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建wxml查询对象</span>
		<span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//查询id为&quot;myCanvas&quot;的元素</span>
		query
			<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;#myCanvas&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">//获得canvas</span>
				<span class="token keyword">const</span> canvas <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node<span class="token punctuation">;</span>

				<span class="token comment">//获取webgl上下文</span>
				<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="微信小游戏端"><a href="#微信小游戏端" class="header-anchor">#</a> 微信小游戏端</h3> <p>在微信小游戏里面，因为小游戏整个场景就是一个全屏的<code>canvas</code>元素，获取上下文的方法比小程序更方便:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//创建一个canvas对象</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取webgl上下文</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="绘制第一个图形"><a href="#绘制第一个图形" class="header-anchor">#</a> 绘制第一个图形</h2> <p>从最简单的三角形开始。三个点确定一个面，面是一个模型的基本单位，因此三角形在计算机图形学里面又被称为“图元”。</p> <h3 id="webgl绘制流程"><a href="#webgl绘制流程" class="header-anchor">#</a> webgl绘制流程</h3> <p>webgl 的绘制流程是：</p> <ol><li>顶点配置：先告诉 webgl 要画多少个顶点，这些顶点的位置分别在什么地方。</li> <li>图元装配：webgl 拿到顶点之后，根据顶点顺序和划分规则，把顶点连接起来成为一个个面片，形成图元，在这个阶段，webgl 可以使用<strong>顶点着色器</strong>对每个顶点进行编辑，比如给顶点进行位移操作等等；3d 模型的顶点，就是在这个阶段，通过与一个<strong>视图矩阵</strong>相乘，把<code>[x,y,z]</code>三维坐标映射到画布里面的<code>[x,y]</code>二维坐标。</li> <li>光栅化：经过上一个流程图元装配后，webgl 知道了每个图元所围住的每个像素，而光栅化，则是给每个像素指定一个颜色，即确定像素的 RGB 值。在这个阶段，webgl 使用<strong>片元着色器</strong>设置像素的 RGB 值。</li></ol> <p>所以我们绘制一个简单的三角形，就需要告诉 webgl 三个点，还需要一个顶点着色器确认/修改点的位置、一个片元着色器给三角形上色。看起来很麻烦，不过不用灰心，跟着步骤慢慢来，你会体验到 webgl 的强大之处。</p> <h3 id="着色器代码"><a href="#着色器代码" class="header-anchor">#</a> 着色器代码</h3> <p>先写下顶点着色器和片元着色器吧，这个比较简单：<br>
顶点着色器:</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码很简单，就是接受一个<code>attribute</code>修饰符的二维矢量类型（<code>vec2</code>）变量<code>a_Position</code>，<code>a_Position</code>存放的是顶点的坐标值，我们把这个坐标值告诉 webgl，也就是<code>gl_Position</code>，注意，glsl 语言是强类型语言，<code>gl_Position</code>的类型是四维矢量（<code>vec4</code>），所以我们使用<code>vec4</code>这个构造函数构造一个四维矢量类型的变量赋值给<code>gl_Position</code></p> <p>片元着色器：</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码更简单了，就是让 webgl 给三角形涂上红色。注意，glsl 中，当四维矢量表示一个颜色时，一维至四维分别代表：红色通道、绿色通道、蓝色通道、alpha 通道。范围值在'0.0~1.0'之间。</p> <h3 id="js代码"><a href="#js代码" class="header-anchor">#</a> js代码</h3> <p>然后，我们开始 js 部分的编写：
首先，我们创建一个 canvas 元素，再获取 webgl 上下文：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">&quot;#000&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来，创建着色器程序，把上面写的两个着色器源码放到浏览器里面编译一下，然后接入着色器程序里面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//创建着色器程序</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建顶点着色器对象</span>
<span class="token keyword">const</span> vtxShader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建片元着色器对象</span>
<span class="token keyword">const</span> fgmShader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//给着色器对象写入代码</span>
gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>
	vtxShader<span class="token punctuation">,</span>
	<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attribute vec2 a_Position;
    void main(){
        gl_Position = vec4(a_Position,0.,1.);
    }</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//编译着色器</span>
gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>vtxShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//把着色器对象绑定到着色器程序上</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vtxShader<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//接下来步骤同上</span>
gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>
	fgmShader<span class="token punctuation">,</span>
	<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">void main(){
        gl_FragColor = vec4(1.,0.,0.,1.);
    }</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>fgmShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fgmShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//链接着色器程序，即把顶点着色器和片元着色器关联起来</span>
gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看到无论是顶点着色器，还是片元着色器，创建方式都是相同的，都是<strong>创建着色器对象 -&gt; 写入着色器源码 -&gt; 编译着色器源码 -&gt; 接入着色器程序</strong>，最后两个着色器都接入到着色器程序里面之后，调用<code>gl.linkProgram</code>方法把这两个着色器给关联起来。</p> <p>接下来，创建一个 webgl 的缓存和一个顶点集合，并且告知 webgl 使用这个缓存，最后把顶点集合写进缓存里面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pointBuf <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pointBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> points<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里的顶点集合设置了三个点：<code>(0,0) (1,0) (0,1)</code>，通过上面的操作，这三个点六个值是写入到 webgl 的缓存里面去了，但 webgl 并不知道要如何使用它们，所以接下来我们要告诉 webgl 如何读取这个缓存：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> aPositionIdx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>aPositionIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>aPositionIdx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码里，先通过<code>gl.getAttribLocation(program,'a_Position')</code>获取到着色器程序里面变量名为<code>a_Position</code>的内存地址（类似指针），然后<code>gl.enableVertexAttribArray(aPositionIdx)</code>允许为<code>aPositionIdx</code>分配顶点数组。最后<code>gl.vertexAttribPointer(aPositionIdx,2,gl.FLOAT,false,0,0)</code>设置顶点数组的分配规则：</p> <ul><li>每次读取数组里面<strong>2</strong>个值作为一个顶点，</li> <li>将这两个值解析成<strong>float</strong>浮点类型，</li> <li><strong>不</strong>需要将这两个值归一化（即计算成 0~1 之间的值），</li> <li>从数组第 <strong>0</strong> 位开始读取，</li> <li>跳过 <strong>0</strong> 位后读取下一个顶点的值。</li></ul> <p>最后，调用着色器程序绘制代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h3> <p>完整代码如下所示：
</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">&quot;#000&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vtxShader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fgmShader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>
	vtxShader<span class="token punctuation">,</span>
	<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attribute vec2 a_Position;
    void main(){
        gl_Position = vec4(a_Position,0.,1.);
    }</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>vtxShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vtxShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>
	fgmShader<span class="token punctuation">,</span>
	<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">void main(){
        gl_FragColor = vec4(1.,0.,0.,1.);
    }</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>fgmShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fgmShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> aPositionIdx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pointBuf <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pointBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> points<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>aPositionIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>aPositionIdx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="js-与着色器程序交互"><a href="#js-与着色器程序交互" class="header-anchor">#</a> js 与着色器程序交互</h2> <h3 id="修改源码"><a href="#修改源码" class="header-anchor">#</a> 修改源码</h3> <p>最简单的交互，莫过于直接用js修改着色器源码了，它是以字符串的形式由js调用编译函数才进行编译，所以js可以通过字符串操作对着色器源码做一些“预编译”操作。但是要注意，修改源码然后频繁执行编译是十分耗性能的事情，容易引起内存泄漏。所以改动只能改一次，就是在编译前针对特定场景改动一些特定的代码而已，一个着色器编译后就不需要重新编译了。</p> <h3 id="修改缓存"><a href="#修改缓存" class="header-anchor">#</a> 修改缓存</h3> <p>上文的代码洋洋洒洒写了一大堆，但实际上核心就是把数据写入缓存，然后由着色器程序执行。而着色器程序是跑在gpu里面的。为了高效地从cpu传递数据到gpu，所以js需要使用类型数组，将数据直接类型格式化后写入底层cpu内存里面。</p> <p>利用这个特点，我们可以让js直接修改缓存的数据，然后再让webgl执行即可，举个例子，让三角形某个顶点跟随鼠标移动：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//接上文代码</span>
canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//把数据归一化（计算成0~1的范围内）</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetX<span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetY<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token comment">//由上文运行结果可知，(0,0)是中心点，左端点是(-1,0)，右端点是(1,0)</span>
    points<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">//由上文运行结果可知，(0,0)是中心点，上端点是(0,1)，下端点是(0,-1)</span>
    points<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">-</span>y<span class="token operator">*</span><span class="token number">2</span>

    <span class="token comment">//重新写入缓存</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> points<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <h3 id="使用attribute变量修改"><a href="#使用attribute变量修改" class="header-anchor">#</a> 使用attribute变量修改</h3> <p>现在，我们已经能够让三角形某个顶点跟随鼠标移动了，那么反过来让我们来写个小游戏：不要让三角形任意一个顶点碰到鼠标！<br>
这非常简单啊，按照上面的例子，只需要拿到鼠标的位置，然后再遍历一下<code>points</code>数组，发现有跟鼠标位置重合的坐标就改一下，最后修改下缓存就大功告成了。<br>
这样当然没问题，那如果有两个三角形、三个三角形、四个三角形乃至成千上万个三角形呢，如果用上面的办法，使用js遍历显然十分吃力了。</p> <p>webgl有什么好办法吗？当然有！webgl绘制流程中第二个流程：图元装配，这个流程可以用着色器更改顶点位置！而且这个运算是在gpu里面完成的，不会阻塞js进程！<br>
所以要做的事情很简单了：</p> <ol><li>告诉webgl鼠标位置</li> <li>用顶点着色器让顶点避开鼠标位置</li></ol> <p>还是先从着色器代码入手：</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Position<span class="token punctuation">;</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Mouse<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">vec2</span> pos <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token keyword">float</span> len <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>a_Mouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pos<span class="token operator">-</span><span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>a_Mouse<span class="token operator">-</span>a_Position<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token operator">*</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先添加了一个新的attribute类型二维矢量变量<code>a_Mouse</code>，用来接收鼠标的位置。然后这里出现了两个新函数，<code>distance</code>和<code>normalize</code>，<code>distance</code>获取的是两个向量之间的距离，也就是两个点之间的距离；<code>normalize</code>获取的是某个向量的单位向量。</p> <p>因为attribute类型的变量不能修改，所以我们新声明了一个变量<code>pos</code>，把<code>a_Position</code>的值传给它。然后计算一下当前顶点与鼠标的距离，判断一下，如果这个距离小于图片的四分之一的话，就让<code>pos</code>往反方向偏移一段距离。最后把新顶点赋值给<code>gl_Position</code>，也就是告诉webgl这个点的位置。</p> <p>然后再看看js部分：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> aMouseIdx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span><span class="token string">'a_Mouse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>aMouseIdx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetX<span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetY<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>aMouseIdx<span class="token punctuation">,</span>x<span class="token operator">*</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">-</span>y<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为顶点着色器里面新增了一个变量，所以先拿到它的内存地址，然后用<code>gl.vertexAttrib2f</code>直接给它赋值。
点击运行可以查看效果：

非常简单！而且效果非常流畅！</p> <h3 id="使用varying传递变量"><a href="#使用varying传递变量" class="header-anchor">#</a> 使用varying传递变量</h3> <p>但是如果我们要更进一步，想让靠近鼠标的地方显示不同的颜色，该怎么做呢？<br>
回顾上面的例子，我们是通过片元着色器给三角形上色的。所以一样的，把鼠标位置传进片元着色器就可以了。</p> <p>那也是在片元着色器里面声明一个<code>attribute a_Mouse</code>？<br>
不不不，<code>attribute</code>只能在顶点着色器内使用，如果我们顶点着色器和片元着色器里面都需要使用这个变量，可以使用<code>varying</code>修饰符，将变量值从顶点着色器传递到片元着色器：</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">//顶点着色器</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Position<span class="token punctuation">;</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Mouse<span class="token punctuation">;</span>
varing <span class="token keyword">vec2</span> v_Mouse<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">vec2</span> pos <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token keyword">float</span> len <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>a_Mouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pos<span class="token operator">-</span><span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>a_Mouse<span class="token operator">-</span>a_Position<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token operator">*</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    v_Mouse <span class="token operator">=</span> a_Mouse
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//片元着色器</span>
<span class="token keyword">varying</span> <span class="token keyword">vec2</span> v_Mouse<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">,</span>v_Mouse<span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用uniform传递变量"><a href="#使用uniform传递变量" class="header-anchor">#</a> 使用uniform传递变量</h3> <p>一般来说，<code>varying</code>修饰符适合传递经过顶点着色器修改后的值。像上面的例子，鼠标的坐标没有经过任何修改就传递出去了，换句话说，就是顶点着色器和片元着色器共用一份同样的数据，那这样的数据，其实没必要使用<code>attribute + varying</code>两个修饰符的组合让两个着色器共享变量的。</p> <p>我们可以使用<code>uniform</code>修饰符：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> uMouseIdx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span><span class="token string">'u_Mouse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>uMouseIdx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetX<span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>offsetY<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>uMouseIdx<span class="token punctuation">,</span>x<span class="token operator">*</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">-</span>y<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>与attribute类似，同样是获得变量地址，然后赋值的操作。然后再看看着色器代码：</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">//顶点着色器</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_Position<span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec2</span> u_Mouse<span class="token punctuation">;</span>
<span class="token keyword">varying</span> <span class="token keyword">float</span> v_len<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">vec2</span> pos <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token keyword">float</span> len <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>u_Mouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_len<span class="token operator">=</span>len<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pos<span class="token operator">-</span><span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>u_Mouse<span class="token operator">-</span>a_Position<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token operator">*</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//片元着色器</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec2</span> u_Mouse<span class="token punctuation">;</span>
<span class="token keyword">varying</span> <span class="token keyword">float</span> v_len<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>v_len<span class="token punctuation">,</span>u_Mouse<span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面着色器中，都直接使用了<code>uniform</code>修饰的变量进行计算，并且演示了<code>varying</code>修饰符真正的作用，即获取顶点坐标与鼠标位置的距离，然后传递给片元着色器当做它的红色通道。而绿色通道与蓝色通道，则分别使用鼠标坐标的x、y值。</p> <h2 id="使用纹理"><a href="#使用纹理" class="header-anchor">#</a> 使用纹理</h2> <h2 id="像素运算"><a href="#像素运算" class="header-anchor">#</a> 像素运算</h2> <h2 id="矩阵"><a href="#矩阵" class="header-anchor">#</a> 矩阵</h2> <h2 id="_3d-成像"><a href="#_3d-成像" class="header-anchor">#</a> 3D 成像</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Graphical/WebGL/share/图像处理技术-空间像素篇.html" class="prev">
        图像处理技术-空间像素篇
      </a></span> <span class="next"><a href="/Graphical/可视化/standard.html">
        规范
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.67496c89.js" defer></script><script src="/assets/js/3.cf7a9944.js" defer></script><script src="/assets/js/148.8184946a.js" defer></script><script src="/assets/js/12.94a768b4.js" defer></script>
  </body>
</html>
